<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@400;700&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <title>Carrinho de Compras - Flor do Campo</title>
    <link rel="stylesheet" href="../../style.css">
    <link rel="stylesheet" href="./carrinho.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
</head>
<body class="min-h-screen bg-gray-50">
    
    <!-- Navbar -->
    <nav class="navbar bg-white shadow-md fixed top-0 left-0 right-0 z-30">
        <div class="container mx-auto flex justify-between items-center p-4">
            <div class="logo">
                <a href="../../index.html" class="logo-link">
                    <h1 class="text-2xl font-bold text-gray-800">Flor do Campo üåº</h1>
                </a>
            </div>
            <div class="nav-right flex items-center space-x-6">
                <div class="search-bar hidden md:flex">
                    <input type="text" placeholder="Buscar produtos..." class="border rounded-l-md p-2" />
                    <button class="bg-green-600 text-white px-4 rounded-r-md hover:bg-green-700"><i class="fas fa-search"></i></button>
                </div>
                <div class="nav-icons flex items-center space-x-4">
                    <a href="./carrinho.html" class="cart-icon cursor-pointer relative">
                        <i class="fas fa-shopping-cart text-xl"></i>
                        <span class="cart-count absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
                    </a>
                    <a href="../LoginPage/login.html" class="user-icon">
                        <i class="fas fa-user text-xl"></i>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8" style="margin-top: 90px;">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-4xl font-bold text-gray-900 mb-4">Seu Carrinho</h1>
        </div>

        <!-- Empty Cart State -->
        <div id="empty-cart" class="text-center py-16">
            <div class="w-32 h-32 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-8">
                <i class="fas fa-shopping-cart text-4xl text-green-600"></i>
            </div>
            <h2 class="text-3xl font-bold text-gray-900 mb-4">Seu carrinho est√° vazio</h2>
            <p class="text-gray-600 mb-8">Que tal adicionar alguns produtos naturais incr√≠veis?</p>
            <a href="../../index.html" class="inline-flex items-center gap-2 bg-gradient-to-r from-green-600 to-emerald-600 text-white px-8 py-3 rounded-xl font-semibold hover:from-green-700 hover:to-emerald-700 transition-all duration-300 shadow-lg hover:shadow-xl">
                <i class="fas fa-arrow-left"></i>
                Continuar Comprando
            </a>
        </div>

        <!-- Cart Content -->
        <div id="cart-content" class="hidden grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Products List -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                    <div class="p-6 border-b border-gray-100">
                        <div class="flex items-center justify-between">
                            <h2 class="text-xl font-bold text-gray-900">Produtos</h2>
                            <button id="clear-cart" class="text-red-500 hover:text-red-700 text-sm font-medium transition-colors">
                                <i class="fas fa-trash mr-1"></i>
                                Limpar carrinho
                            </button>
                        </div>
                    </div>
                    
                    <div id="cart-items" class="divide-y divide-gray-100">
                        <!-- Cart items will be loaded here -->
                    </div>
                </div>

                <!-- Coupon Section -->
                <div class="mt-6 bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">
                        <i class="fas fa-ticket-alt text-green-600 mr-2"></i>
                        Cupom de Desconto
                    </h3>
                    <div id="coupon-form" class="flex gap-2">
                        <input type="text" id="coupon-input" placeholder="Digite seu cupom (ex: FLORDOCAMPO10)" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none">
                        <button id="apply-coupon" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium">
                            Aplicar
                        </button>
                    </div>
                    <div id="coupon-applied" class="hidden mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check-circle text-green-600"></i>
                                <span class="text-green-800 font-medium">Cupom aplicado com sucesso!</span>
                            </div>
                            <button id="remove-coupon" class="text-red-500 hover:text-red-700">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Order Summary -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6 sticky top-24">
                    <h2 class="text-xl font-bold text-gray-900 mb-6">
                        <i class="fas fa-receipt text-green-600 mr-2"></i>
                        Resumo do Pedido
                    </h2>

                    <div class="space-y-4 mb-6">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Subtotal</span>
                            <span id="subtotal" class="font-semibold">R$ 0,00</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Frete</span>
                            <span id="shipping" class="font-semibold">R$ 15,00</span>
                        </div>
                        <div id="discount-line" class="hidden flex justify-between">
                            <span class="text-gray-600">Desconto</span>
                            <span id="discount" class="font-semibold text-green-600">-R$ 0,00</span>
                        </div>
                        <div class="border-t border-gray-200 pt-4">
                            <div class="flex justify-between text-lg font-bold">
                                <span>Total</span>
                                <span id="total" class="text-green-600">R$ 0,00</span>
                            </div>
                        </div>
                    </div>

                    <!-- Free Shipping Info -->
                    <div id="shipping-info" class="mb-6 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                        <p class="text-sm text-blue-800">
                            <i class="fas fa-info-circle mr-1"></i>
                            <span id="shipping-message">Adicione mais R$ 100,00 para frete gr√°tis!</span>
                        </p>
                    </div>

                    <!-- Action Buttons -->
                    <div class="space-y-3">
                        <button id="checkout-btn" class="w-full bg-gradient-to-r from-green-600 to-emerald-600 text-white py-3 px-4 rounded-xl font-semibold hover:from-green-700 hover:to-emerald-700 transition-all duration-300 shadow-lg hover:shadow-xl">
                            <i class="fas fa-credit-card mr-2"></i>
                            Finalizar Compra
                        </button>
                        
                        <a href="../../index.html" class="w-full inline-flex items-center justify-center gap-2 bg-gray-100 text-gray-700 py-3 px-4 rounded-xl font-medium hover:bg-gray-200 transition-colors">
                            <i class="fas fa-arrow-left"></i>
                            Continuar Comprando
                        </a>
                    </div>

                    <!-- Security Badge -->
                    <div class="mt-6 text-center">
                        <div class="flex items-center justify-center gap-2 text-sm text-gray-500">
                            <i class="fas fa-shield-alt text-green-600"></i>
                            <span>Compra 100% segura</span>
                        </div>
                        <div class="flex items-center justify-center gap-3 mt-2">
                            <i class="fab fa-cc-visa text-2xl text-blue-600"></i>
                            <i class="fab fa-cc-mastercard text-2xl text-red-500"></i>
                            <i class="fab fa-cc-paypal text-2xl text-blue-500"></i>
                            <i class="fas fa-barcode text-2xl text-gray-600"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-green-800 text-white py-12">
        <div class="container mx-auto px-6">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <div class="flex items-center mb-4">
                        <i class="fas fa-leaf text-green-300 text-2xl mr-2"></i>
                        <h3 class="text-xl font-bold">Flor do Campo</h3>
                    </div>
                    <p class="text-green-100 mb-4">
                        Produtos naturais e org√¢nicos para seu bem-estar e qualidade de vida.
                        Cuidando de voc√™ e do meio ambiente.
                    </p>
                    <p class="text-green-200 text-sm">100% Natural</p>
                </div>

                <div>
                    <h4 class="font-semibold mb-4 text-green-100">Links R√°pidos</h4>
                    <ul class="space-y-2">
                        <li><a href="../../index.html" class="text-green-200 hover:text-white transition-colors"><i class="fas fa-home mr-2"></i>In√≠cio</a></li>
                        <li><a href="../../index.html#produtos" class="text-green-200 hover:text-white transition-colors"><i class="fas fa-shopping-bag mr-2"></i>Produtos</a></li>
                        <li><a href="#" class="text-green-200 hover:text-white transition-colors"><i class="fas fa-info-circle mr-2"></i>Sobre</a></li>
                        <li><a href="#" class="text-green-200 hover:text-white transition-colors"><i class="fas fa-envelope mr-2"></i>Contato</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="font-semibold mb-4 text-green-100">Categorias</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-green-200 hover:text-white transition-colors"><i class="fas fa-leaf mr-2"></i>Ch√°s</a></li>
                        <li><a href="#" class="text-green-200 hover:text-white transition-colors"><i class="fas fa-spa mr-2"></i>Cosm√©ticos</a></li>
                        <li><a href="#" class="text-green-200 hover:text-white transition-colors"><i class="fas fa-apple-alt mr-2"></i>Alimentos</a></li>
                        <li><a href="#" class="text-green-200 hover:text-white transition-colors"><i class="fas fa-pills mr-2"></i>Suplementos</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="font-semibold mb-4 text-green-100">Contato</h4>
                    <div class="space-y-2">
                        <p class="text-green-200">
                            <i class="fas fa-phone mr-2"></i>
                            Telefone<br>
                            (11) 99999-9999
                        </p>
                        <p class="text-green-200">
                            <i class="fas fa-envelope mr-2"></i>
                            Email<br>
                            contato@flordocampo.com
                        </p>
                    </div>
                    <div class="mt-4">
                        <h5 class="font-medium mb-2 text-green-100">Siga-nos:</h5>
                        <div class="flex space-x-3">
                            <a href="#" class="text-green-200 hover:text-white transition-colors"><i class="fab fa-facebook text-xl"></i></a>
                            <a href="#" class="text-green-200 hover:text-white transition-colors"><i class="fab fa-instagram text-xl"></i></a>
                            <a href="#" class="text-green-200 hover:text-white transition-colors"><i class="fab fa-whatsapp text-xl"></i></a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="border-t border-green-700 mt-8 pt-8 text-center">
                <p class="text-green-200">¬© 2025 Flor do Campo. Todos os direitos reservados.</p>
                <div class="mt-2">
                    <a href="#" class="text-green-200 hover:text-white transition-colors text-sm mr-4">Pol√≠tica de Privacidade</a>
                    <a href="#" class="text-green-200 hover:text-white transition-colors text-sm mr-4">Termos de Uso</a>
                    <a href="#" class="text-green-200 hover:text-white transition-colors text-sm">FAQ</a>
                </div>
            </div>
        </div>
    </footer>

    <script type="module" src="../../JavaScript/carrinho.js"></script>
    <script type="module">
        // Import produtos data
        import { produtos } from '../../JavaScript/dados/produtos.js';
        
        // Cart Management
        let cart = JSON.parse(localStorage.getItem('carrinho')) || [];
        let appliedCoupon = null;
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updateCartDisplay();
            updateCartCount();
            
            // Event listeners
            document.getElementById('clear-cart').addEventListener('click', clearCart);
            document.getElementById('apply-coupon').addEventListener('click', applyCoupon);
            document.getElementById('remove-coupon').addEventListener('click', removeCoupon);
            document.getElementById('checkout-btn').addEventListener('click', checkout);
        });

        function updateCartDisplay() {
            const emptyCart = document.getElementById('empty-cart');
            const cartContent = document.getElementById('cart-content');
            
            if (cart.length === 0) {
                emptyCart.classList.remove('hidden');
                cartContent.classList.add('hidden');
            } else {
                emptyCart.classList.add('hidden');
                cartContent.classList.remove('hidden');
                renderCartItems();
                updateOrderSummary();
            }
        }

        function renderCartItems() {
            const container = document.getElementById('cart-items');
            container.innerHTML = cart.map(item => {
                // Find product data by ID
                const produto = produtos.find(p => p.id === item.id);
                if (!produto) return ''; // Skip if product not found
                
                return `
                <div class="p-6">
                    <div class="flex items-center gap-4">
                        <div class="w-20 h-20 bg-gray-100 rounded-xl overflow-hidden flex-shrink-0">
                            <img src="${produto.imagem}" alt="${produto.nome}" class="w-full h-full object-cover" 
                                 onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2YzZjRmNiIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGZpbGw9IiM5OWEzYWYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5JbWFnZW08L3RleHQ+PC9zdmc+'" />
                        </div>
                        
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-semibold text-gray-900 truncate">${produto.nome}</h3>
                            <p class="text-sm text-gray-500 capitalize">${produto.categoria}</p>
                            <p class="text-xl font-bold text-green-600 mt-1">R$ ${produto.preco.toFixed(2)}</p>
                        </div>
                        
                        <div class="flex items-center gap-3">
                            <div class="flex items-center border border-gray-300 rounded-lg">
                                <button onclick="updateQuantity(${item.id}, ${item.quantidade - 1})" class="p-2 hover:bg-gray-100 transition-colors">
                                    <i class="fas fa-minus text-gray-500"></i>
                                </button>
                                <span class="px-4 py-2 text-gray-900 font-semibold min-w-[3rem] text-center">${item.quantidade}</span>
                                <button onclick="updateQuantity(${item.id}, ${item.quantidade + 1})" class="p-2 hover:bg-gray-100 transition-colors">
                                    <i class="fas fa-plus text-gray-500"></i>
                                </button>
                            </div>
                            
                            <button onclick="removeFromCart(${item.id})" class="p-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="mt-4 flex justify-end">
                        <p class="text-lg font-semibold text-gray-900">
                            Subtotal: R$ ${(produto.preco * item.quantidade).toFixed(2)}
                        </p>
                    </div>
                </div>
                `;
            }).join('');
        }

        function updateQuantity(productId, newQuantity) {
            if (newQuantity <= 0) {
                removeFromCart(productId);
                return;
            }
            
            const item = cart.find(item => item.id === productId);
            if (item) {
                item.quantidade = newQuantity;
                saveCart();
                updateCartDisplay();
                updateCartCount();
            }
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            saveCart();
            updateCartDisplay();
            updateCartCount();
            showToast('Produto removido do carrinho', 'info');
        }

        function clearCart() {
            if (confirm('Tem certeza que deseja limpar o carrinho?')) {
                cart = [];
                appliedCoupon = null;
                saveCart();
                updateCartDisplay();
                updateCartCount();
                showToast('Carrinho limpo', 'info');
            }
        }

        function updateOrderSummary() {
            const subtotal = cart.reduce((sum, item) => {
                const produto = produtos.find(p => p.id === item.id);
                return sum + (produto ? produto.preco * item.quantidade : 0);
            }, 0);
            const shipping = subtotal >= 100 ? 0 : 15;
            const discount = appliedCoupon ? subtotal * 0.1 : 0;
            const total = subtotal + shipping - discount;
            
            document.getElementById('subtotal').textContent = `R$ ${subtotal.toFixed(2)}`;
            document.getElementById('shipping').textContent = shipping === 0 ? 'Gr√°tis' : `R$ ${shipping.toFixed(2)}`;
            document.getElementById('total').textContent = `R$ ${total.toFixed(2)}`;
            
            // Update shipping info
            const shippingInfo = document.getElementById('shipping-info');
            const shippingMessage = document.getElementById('shipping-message');
            
            if (subtotal >= 100) {
                shippingInfo.className = 'mb-6 p-3 bg-green-50 border border-green-200 rounded-lg';
                shippingMessage.innerHTML = '<i class="fas fa-check-circle mr-1"></i>Frete gr√°tis aplicado!';
            } else {
                shippingInfo.className = 'mb-6 p-3 bg-blue-50 border border-blue-200 rounded-lg';
                shippingMessage.innerHTML = `<i class="fas fa-info-circle mr-1"></i>Adicione mais R$ ${(100 - subtotal).toFixed(2)} para frete gr√°tis!`;
            }
            
            // Update discount display
            const discountLine = document.getElementById('discount-line');
            const discountElement = document.getElementById('discount');
            
            if (discount > 0) {
                discountLine.classList.remove('hidden');
                discountElement.textContent = `-R$ ${discount.toFixed(2)}`;
            } else {
                discountLine.classList.add('hidden');
            }
        }

        function applyCoupon() {
            const couponInput = document.getElementById('coupon-input');
            const couponCode = couponInput.value.trim().toLowerCase();
            
            if (couponCode === 'flordocampo10') {
                appliedCoupon = couponCode;
                document.getElementById('coupon-form').classList.add('hidden');
                document.getElementById('coupon-applied').classList.remove('hidden');
                updateOrderSummary();
                showToast('Cupom aplicado com sucesso! 10% de desconto', 'success');
            } else {
                showToast('Cupom inv√°lido. Tente: FLORDOCAMPO10', 'error');
            }
            
            couponInput.value = '';
        }

        function removeCoupon() {
            appliedCoupon = null;
            document.getElementById('coupon-form').classList.remove('hidden');
            document.getElementById('coupon-applied').classList.add('hidden');
            updateOrderSummary();
            showToast('Cupom removido', 'info');
        }

        function checkout() {
            if (cart.length === 0) {
                showToast('Carrinho vazio', 'error');
                return;
            }
            
            // Simulate checkout process
            showToast('Redirecionando para o checkout...', 'info');
            setTimeout(() => {
                alert('Pedido realizado com sucesso! Obrigado pela compra.');
                cart = [];
                appliedCoupon = null;
                saveCart();
                updateCartDisplay();
                updateCartCount();
            }, 2000);
        }

        function saveCart() {
            localStorage.setItem('carrinho', JSON.stringify(cart));
        }

        function updateCartCount() {
            const cartCount = document.getElementById('cart-count');
            if (cartCount) {
                cartCount.textContent = cart.length;
            }
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white z-50 transition-all duration-300 ${
                type === 'success' ? 'bg-green-600' : 
                type === 'error' ? 'bg-red-600' : 'bg-blue-600'
            }`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    if (document.body.contains(toast)) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // Make functions global for onclick handlers
        window.updateQuantity = updateQuantity;
        window.removeFromCart = removeFromCart;
    </script>
    
    <!-- Add main.js for search functionality -->
    <script type="module" src="../../JavaScript/main.js"></script>
</body>
</html>
